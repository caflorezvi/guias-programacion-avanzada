```
Programa de Ingenier칤a de Sistemas y Computaci칩n
Universidad del Quind칤o

T칤tulo: Sentencias b치sicas en SQL
Duraci칩n estimada: 120
Docentes: Carlos Andr칠s Florez, Christian Andr칠s Candela
Gu칤a: 07
```

# Sentencias b치sicas en SQL

### 游꿢 Objetivo
Conocer los conceptos b치sicos del lenguaje SQL, esencial en las bases de datos relacionales.

---

### Conceptos B치sicos
MariaDB, l칤nea de comandos.

---

## Contextualizaci칩n Te칩rica

Una **base de datos** es un conjunto de datos estructurados que se almacenan y gestionan de manera eficiente. Hay dos tipos principales de bases de datos: las bases de datos relacionales y las bases de datos no relacionales. En este documento nos enfocaremos en las **bases de datos relacionales**, que utilizan tablas para representar los datos y sus relaciones.

**SQL** (Structured Query Language) es un lenguaje dise침ado para administrar y recuperar informaci칩n de sistemas de gesti칩n de bases de datos relacionales, como por ejemplo MariaDB o MySQL.

Las bases de datos relacionales se organizan en dos marcadas secciones: el **esquema** y **los datos** (o instancias). El esquema es la definici칩n de la estructura de la base de datos y principalmente almacena los siguientes datos:

- El nombre de cada tabla.
- Las columnas de cada tabla (cada columna tiene un nombre, un tipo de dato y puede tener restricciones).
- La relaci칩n de cada columna con otras tablas.

Existen dos subconjuntos de sentencias SQL, uno para la definici칩n del esquema de la base de datos que se llama **DDL** y otro para la manipulaci칩n de los datos (o instancias) que se llama **DML**.

### Lenguaje de definici칩n de datos (DDL)
Es un conjunto de instrucciones para trabajar con el esquema. Principalmente:
- `CREATE <algo>`
- `ALTER <algo> <c칩mo>`
- `DROP <algo>`

### Lenguaje de manipulaci칩n de datos (DML)
Es un conjunto de instrucciones para trabajar con los datos. Principalmente:
- `SELECT <campos> FROM <tabla> WHERE <condiciones>`
- `INSERT INTO <tabla> (<campo1>, ...) VALUES (<valor1>,...)`
- `UPDATE <tabla> SET <campo> = <valor> WHERE <condici칩n>`
- `DELETE FROM <tabla> WHERE <condici칩n>`

---

## Procedimiento

Una tienda requiere un sistema de informaci칩n que le permita gestionar la informaci칩n de sus productos, clientes y transacciones:
- De cada producto se debe almacenar su c칩digo, nombre, precio, unidades y tipo
- De cada transacci칩n se debe registrar su c칩digo, el cliente que realiza la compra, el (o los) productos que compra, fecha de compra y pago
- Del pago se debe registrar su fecha, total pagado, estado del pago y m칠todo de pago
- Por 칰ltimo, del cliente se requiere su c칠dula, nombre, email y tel칠fono

### 1. Dise침ar el diagrama entidad relaci칩n

Modelar todos los datos del problema.

```mermaid
erDiagram
    Cliente {
        varchar cedula PK
        varchar nombre
        varchar email
        varchar telefono
    }
    
    Producto {
        varchar codigo PK
        varchar nombre
        int unidades
        float precio
        varchar codigo_tipo FK
    }
    
    Tipo_Producto {
        int codigo PK
        varchar nombre
    }
    
    Transaccion {
        int codigo PK
        date fecha
        string codigo_pago FK
        string cedula_cliente FK
    }
    
    Transaccion_Producto {
        int codigo_transaccion PK, FK
        varchar codigo_producto PK, FK
        int unidades
        float precio_unitario
    }
    
    Pago {
        int codigo PK
        date fecha
        float total_pagado
        varchar medio_pago
        varchar estado
    }
    
    Cliente ||--o{ Transaccion : ""
    Tipo_Producto ||--o{ Producto : ""
    Transaccion ||--o{ Transaccion_Producto : ""
    Producto ||--o{ Transaccion_Producto : ""
    Pago ||--|| Transaccion : ""
```

### 2. Crear la base de datos

Ingresar al monitor de base de datos, crear la base de datos `tienda` y acceder a ella:

```bash
$ mariadb -u root -p
```
Al ingresar la contrase침a, debe aparecer el prompt de MariaDB, y debe ejecutar los siguientes comandos:

```sql
create database tienda;
use tienda;
```

### 3. Crear tabla cliente

Se recomienda crear primero las tablas que no dependen de otra tabla. Cada tabla debe tener una llave primaria (**Primary key**) que identifica cada registro como 칰nico dentro de la tabla:

```sql
create table cliente(
    cedula varchar(10) not null,
    nombre varchar(200) not null,
    email varchar(100) not null unique,
    telefono varchar(12),
    primary key (cedula)
);
```
Para mostrar la estructura de la tabla, se puede usar:

```sql
describe cliente;
```

### 4. Crear tabla tipo_producto

La llave primaria ser치 un campo autoincrementable de tipo `int`:

```sql
create table tipo_producto(
    codigo int not null auto_increment,
    nombre varchar(200) not null,
    primary key (codigo)
);
```

### 5. Crear tabla producto
Esta tabla depende de `tipo_producto` mediante una llave for치nea (**Foreign Key**). La llave for치nea identifica una columna en una tabla hija que se refiere a una columna en otra tabla:

```sql
create table producto(
    codigo varchar(10) not null,
    nombre varchar(200) not null,
    precio float not null,
    unidades int not null,
    tipo int not null,
    primary key (codigo),
    foreign key (tipo) references tipo_producto (codigo)
);
```

>**丘멆잺 IMPORTANTE:** Las llaves for치neas deben ser del mismo tipo de dato y misma longitud que la llave primaria que referencian.

### 6. Crear tabla pago
Necesaria para la tabla transacci칩n:

```sql
create table pago(
    codigo int not null auto_increment,
    fecha date not null,
    total_pago float not null,
    estado varchar(10) not null,
    metodo_pago varchar(50) not null,
    primary key (codigo)
);
```

>**丘멆잺 Nota**: Esta tabla se puede normalizar creando tablas separadas para estado y m칠todo de pago.

### 7. Crear tabla transaccion
Depende de las tablas `cliente` y `pago` mediante llaves for치neas:

```sql
create table transaccion(
    codigo int not null auto_increment,
    fecha date not null,
    cedula_cliente varchar(10) not null,
    codigo_pago int not null,
    primary key (codigo),
    foreign key (cedula_cliente) references cliente (cedula),
    foreign key (codigo_pago) references pago (codigo)
);
```

### 8. Crear tabla transaccion_producto
Soluciona la relaci칩n muchos a muchos entre transacci칩n y producto. La llave primaria est치 compuesta por las llaves primarias de las tablas involucradas:

```sql
create table transaccion_producto(
    codigo_transaccion int not null,
    codigo_producto varchar(10) not null,
    unidades int not null,
    precio_unitario float not null,
    primary key (codigo_transaccion, codigo_producto),
    foreign key (codigo_transaccion) references transaccion (codigo),
    foreign key (codigo_producto) references producto (codigo)
);
```

### 9. Comandos adicionales
Una vez definida la estructura, se pueden usar:
- `DROP` para borrar tablas
- `ALTER` para modificarlas

### 10. Insertar clientes de prueba
Para ingresar registros se usa `INSERT INTO`:

```sql
insert into cliente values ("123", "Pepito", "pepe@mail.com", "7827827");
insert into cliente(cedula, nombre, email) values ("124", "Juanita", "juana@mail.com");
insert into cliente values ("125", "Pablo", "pablo@mail.com", "7901234");
```

### 11. Consultar registros
La sentencia `SELECT` permite obtener registros:

```sql
select * from cliente;
```

### 12. Actualizar y eliminar registros
Ejemplo para actualizar el tel칠fono de un cliente:

```sql
update cliente set telefono = "7500000" where cedula = "124";
select * from cliente; 
```

Ejemplo para eliminar un cliente:

```sql
delete from cliente where cedula = "125";
select * from cliente;
```

### 13. Insertar tipos de productos
Solo se define el nombre, el c칩digo es autoincrementable:

```sql
insert into tipo_producto(nombre) values ("Tecnolog칤a");
insert into tipo_producto(nombre) values ("Electrodom칠stico");
insert into tipo_producto(nombre) values ("Deporte");
```
Para consultar los tipos de productos:
```sql
select * from tipo_producto;
```

### 14. Insertar productos
Deben existir tipos de productos previamente registrados:

```sql
insert into producto values ("a12", "Teclado gamer", 300000, 2, 1);
insert into producto values ("b43", "Nintendo Switch OLED", 1500000, 1, 1);
insert into producto values ("h62", "Tenis Adidas", 450000, 10, 3);
```

### 15. Insertar registros relacionados
Ejemplo completo de inserci칩n con llaves for치neas:

```sql
insert into pago(fecha, total_pago, estado, metodo_pago) values ("2023/08/15", 300000, "APROBADA", "PSE");
insert into transaccion(fecha, cedula_cliente, codigo_pago) values ("2023/08/15", "123", 1);
insert into transaccion_producto values (1, "a12", 1, 300000);
```

### 16. Usar JOIN para relacionar tablas
La instrucci칩n `JOIN` permite mezclar tablas para completar informaci칩n:

```sql
-- JOIN b치sico (mezcla todos los registros)
select * from cliente join transaccion;

-- JOIN con restricci칩n usando ON
select * from cliente c join transaccion t on c.cedula = t.cedula_cliente;

-- JOIN seleccionando campos espec칤ficos
select c.cedula, c.nombre, t.codigo, t.fecha from cliente c join transaccion t on c.cedula = t.cedula_cliente;
```

### 17. Herramientas con GUI para bases de datos
Existen diversas herramientas con interfaz gr치fica que facilitan la gesti칩n de bases de datos, tales como:

- **MySQL Workbench**: Permite dise침ar, modelar y gestionar bases de datos MySQL.
- **Outerbase**: Herramienta de administraci칩n para bases de datos de diferentes motores.
- **HeidiSQL**: Ligera y f치cil de usar, ideal para gestionar bases de datos MySQL y MariaDB.

Si lo desea, puede explorar estas herramientas para facilitar su trabajo con bases de datos. Se recomienda **Outerbase** por su simplicidad y versatilidad.

---

## Tarea

1. A침ada una llave for치nea en la tabla cliente para que quede guardado en qu칠 ciudad vive.

2. A침ada un campo en la tabla producto para que tenga una descripci칩n. Este campo debe ser de tipo `TEXT` (no `VARCHAR`) ya que la descripci칩n puede ser tan extensa como el usuario decida.

3. Dise침e un diagrama entidad-relaci칩n para este ejercicio: Una biblioteca requiere un sistema de informaci칩n que le permita gestionar la informaci칩n de sus libros y pr칠stamos:
   - De cada libro se debe almacenar la informaci칩n de su autor (o autores), isbn, nombre, g칠nero, a침o, unidades
   - De cada pr칠stamo se debe registrar el c칩digo, la persona que pide el pr칠stamo, el (o los) libros que presta, fecha del pr칠stamo, fecha de devoluci칩n
   - De la persona se requiere la c칠dula, nombre, email y tel칠fono
   - Del autor su nombre y nacionalidad